<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ä¸ºä½“éªŒKubernetesä»¥åŠCiliumç»„åˆåœ¨ä¸€èµ·äº§ç”Ÿçš„æ–°ç‰¹æ€§ï¼Œæˆ‘è®¡åˆ’å°†Kuberneteså‡çº§åˆ°1.24&#43;ï¼Œå¹¶ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆciliu'>
<title>cri-dockerdï¼Œåœ¨kubernetes1.24åç»§ç»­ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶</title>

<link rel='canonical' href='https://lizonglingo.github.io/p/cri-dockerd%E5%9C%A8kubernetes1.24%E5%90%8E%E7%BB%A7%E7%BB%AD%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/'>

<link rel="stylesheet" href="/scss/style.min.811a71d93d8df406268b1c66d015cd3f2252f454f25ac10a683e6f7b5ad9d92d.css"><meta property='og:title' content='cri-dockerdï¼Œåœ¨kubernetes1.24åç»§ç»­ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶'>
<meta property='og:description' content='ä¸ºä½“éªŒKubernetesä»¥åŠCiliumç»„åˆåœ¨ä¸€èµ·äº§ç”Ÿçš„æ–°ç‰¹æ€§ï¼Œæˆ‘è®¡åˆ’å°†Kuberneteså‡çº§åˆ°1.24&#43;ï¼Œå¹¶ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆciliu'>
<meta property='og:url' content='https://lizonglingo.github.io/p/cri-dockerd%E5%9C%A8kubernetes1.24%E5%90%8E%E7%BB%A7%E7%BB%AD%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/'>
<meta property='og:site_name' content='fmt.Println(&#34;Li Duo&#34;)'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='äº‘åŸç”Ÿ' /><meta property='article:tag' content='Kubernetes' /><meta property='article:tag' content='docker' /><meta property='article:tag' content='ç¬”è®°' /><meta property='article:tag' content='ä¸­é—´ä»¶' /><meta property='article:published_time' content='2022-08-01T18:10:59&#43;08:00'/><meta property='article:modified_time' content='2022-08-01T18:10:59&#43;08:00'/><meta property='og:image' content='https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20230111161434207.png' />
<meta name="twitter:title" content="cri-dockerdï¼Œåœ¨kubernetes1.24åç»§ç»­ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶">
<meta name="twitter:description" content="ä¸ºä½“éªŒKubernetesä»¥åŠCiliumç»„åˆåœ¨ä¸€èµ·äº§ç”Ÿçš„æ–°ç‰¹æ€§ï¼Œæˆ‘è®¡åˆ’å°†Kuberneteså‡çº§åˆ°1.24&#43;ï¼Œå¹¶ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆciliu"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20230111161434207.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    <img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/1634453613659.jpeg" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                </a>
                
                    <span class="emoji">ğŸ‘‹</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">fmt.Println(&#34;Li Duo&#34;)</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/lizonglingo'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
            
        
                
                <li >
                    <a href='/' >
                        
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                        
                        <span>ä¸»é¡µ</span>
                    </a>
                </li>
                
            
        
        
            
        
                
                <li >
                    <a href='/%E5%85%B3%E4%BA%8E/' >
                        
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                        
                        <span>å…³äº</span>
                    </a>
                </li>
                
            
        
        
            
        
                
                <li >
                    <a href='/archives/' >
                        
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                        
                        <span>å½’æ¡£</span>
                    </a>
                </li>
                
            
        
        
            
        
        
        
            
        
                
                <li >
                    <a href='/%E9%93%BE%E6%8E%A5/' >
                        
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                        <span>é“¾æ¥</span>
                    </a>
                </li>
                
            
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                <form action="/search/" class="search-form widget" >
        <p>
            <label>æœç´¢</label>
            <input name="keyword" required placeholder="è¾“å…¥å…³é”®è¯..." />
        
            <button title="æœç´¢">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
            
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#dockershimå’Œå®¹å™¨è¿è¡Œæ—¶">Dockershimå’Œå®¹å™¨è¿è¡Œæ—¶</a>
      <ul>
        <li><a href="#å¼ƒç”¨dockershimådockerè¿˜æœ‰ç”¨å—">å¼ƒç”¨dockershimåï¼ŒDockerè¿˜æœ‰ç”¨å—ï¼Ÿ</a></li>
      </ul>
    </li>
    <li><a href="#åœ¨æ–°ç‰ˆæœ¬é›†ç¾¤ä¸­ä½¿ç”¨cri-dockerd">åœ¨æ–°ç‰ˆæœ¬é›†ç¾¤ä¸­ä½¿ç”¨cri-dockerd</a>
      <ul>
        <li><a href="#å®‰è£…å¹¶é…ç½®cri-dockerd">å®‰è£…å¹¶é…ç½®cri-dockerd</a></li>
        <li><a href="#ä¿®æ”¹kubeadm-configæ–‡ä»¶">ä¿®æ”¹kubeadm configæ–‡ä»¶</a></li>
        <li><a href="#å¯åŠ¨é›†ç¾¤å¯åŠ¨å¤±è´¥">å¯åŠ¨é›†ç¾¤(å¯åŠ¨å¤±è´¥)</a></li>
        <li><a href="#cni">CNI</a></li>
        <li><a href="#å†æ¬¡å¯åŠ¨é›†ç¾¤">å†æ¬¡å¯åŠ¨é›†ç¾¤</a></li>
      </ul>
    </li>
    <li><a href="#ä¸€äº›é—®é¢˜">ä¸€äº›é—®é¢˜</a>
      <ul>
        <li><a href="#cri-dockerdæŠ¥é”™">cri-dockerdæŠ¥é”™</a></li>
        <li><a href="#cri-dockerdå¸¸é©»ä¸€ä¸ªç»ˆç«¯">cri-dockerdå¸¸é©»ä¸€ä¸ªç»ˆç«¯</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/cri-dockerd%E5%9C%A8kubernetes1.24%E5%90%8E%E7%BB%A7%E7%BB%AD%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/">
                
                    <img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20230111161434207.png" loading="lazy" alt="Featured image of post cri-dockerdï¼Œåœ¨kubernetes1.24åç»§ç»­ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" >
                äº‘åŸç”Ÿ
            </a>
        
            <a href="/categories/kubernetes/" >
                Kubernetes
            </a>
        
            <a href="/categories/docker/" >
                docker
            </a>
        
            <a href="/categories/%E7%AC%94%E8%AE%B0/" >
                ç¬”è®°
            </a>
        
            <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" >
                ä¸­é—´ä»¶
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/cri-dockerd%E5%9C%A8kubernetes1.24%E5%90%8E%E7%BB%A7%E7%BB%AD%E4%BD%BF%E7%94%A8docker%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/">cri-dockerdï¼Œåœ¨kubernetes1.24åç»§ç»­ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 01, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 15 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <blockquote>
<p>ä¸ºä½“éªŒKubernetesä»¥åŠCiliumç»„åˆåœ¨ä¸€èµ·äº§ç”Ÿçš„æ–°ç‰¹æ€§ï¼Œæˆ‘è®¡åˆ’å°†Kuberneteså‡çº§åˆ°1.24+ï¼Œå¹¶ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆcilium1.12æ¥ä½œé›†ç¾¤ç½‘ç»œã€‚</p>
<p>æˆ‘æ‰€çœ‹é‡çš„æœ€å¤§æ”¹å˜ï¼š</p>
<ul>
<li>kubernetes1.24+æ­£å¼ç§»é™¤dockershimï¼Œå…³äºâ€œkuberneteså¼ƒç”¨Dockerâ€è¿™ä¸€è¯é¢˜ä¹Ÿç®—æ˜¯å°˜åŸƒè½å®šï¼Œkubernetesæ­£å¼æ‹¥æŠ±çº¯å‡€çš„CRIã€‚</li>
<li>cilium1.12åæ­£å¼æ”¯æŒkubernetes1.24.0ï¼Œå¹¶ä¸”å…¶é‡å¤§çš„æ–°ç‰¹æ€§cilium service meshå¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œâ€œmulti control planâ€ã€â€œsidercar/sidercar-freeâ€ç­‰äº®ç‚¹è®©æˆ‘å¾ˆæƒ³å°è¯•ï¼Œæ˜¯ä¸æ˜¯åŸºäºeBPFçš„service meshåœ¨æ€§èƒ½å¼€é”€ã€æŒ‡æ ‡ç²’åº¦ä¸Šèƒ½å¤Ÿç»™äº‘ä¸Šå¯è§‚æµ‹æ€§å¸¦æ¥æ›´å¥½çš„ä½“éªŒã€‚</li>
</ul>
</blockquote>
<p>æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œç§»é™¤dockershimåï¼Œæˆ‘ä»¬æ€æ ·ç»§ç»­ä½¿ç”¨docker engineä½œä¸ºåº•å±‚çš„å®¹å™¨ç®¡ç†ä»¥åŠè¿è¡Œæ—¶ç®¡ç†è€…å‘¢ï¼Ÿ</p>
<h2 id="dockershimå’Œå®¹å™¨è¿è¡Œæ—¶">Dockershimå’Œå®¹å™¨è¿è¡Œæ—¶</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæä¾›æœåŠ¡çš„ç»ˆç‚¹æ˜¯Podä¸­è¿è¡Œçš„å®¹å™¨ï¼Œkubernetesæœ¬èº«å¹¶ä¸æä¾›è¿™ç§èƒ½åŠ›ï¼Œè€Œæ˜¯ä¾èµ–CRIå»æ¥å…¥å…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼Œå®ç°è¿™æ ·çš„èƒ½åŠ›çš„ã€‚æˆ‘ä»¬æœ€ç›´æ¥çš„ä½“ä¼šå°±æ˜¯kuberneteså¯ä»¥æŒ‰ç…§å£°æ˜æ–‡ä»¶è‡ªåŠ¨æ‹‰å–ã€è¿è¡Œå®¹å™¨ï¼Œå…¶å®è¿™éƒ½æ˜¯å®¹å™¨è¿è¡Œæ—¶çš„å·¥ä½œã€‚ä¾‹å¦‚dockerï¼Œå®ƒå°±æœ‰è¿™æ ·çš„èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨k8så‘å±•åˆæœŸï¼ŒDockerç”šè‡³æ¯”k8sæ›´æœ‰çŸ¥ååº¦ï¼ŒåŒæ—¶Dockeræ¯”k8s CRIè¿™æ ·æ¦‚å¿µè¦æ—©ï¼Œdocker engineä¹Ÿå°±æ²¡æœ‰å®ç°CRIæ¥å£è¿™ä¸€è¯´ï¼Œæ‰€ä»¥k8sä½¿ç”¨<code>dockershim</code>ä½œä¸ºæ”¯æ’‘dockerè¿™ä¸€å®¹å™¨è¿è¡Œæ—¶çš„è¿‡æ¸¡ã€‚å› æ­¤åœ¨k8sæ—©æœŸç‰ˆæœ¬ï¼Œå°±é’ˆå¯¹dockerè¿™ä¸ªå®¹å™¨è¿è¡Œæ—¶åšäº†é€‚é…ã€‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„kubeletåœ¨dockershimçš„èƒ½åŠ›ä¸‹ï¼Œå¯ä»¥ä¸èŠ‚ç‚¹ä¸Šçš„docker engineè¿›è¡Œäº¤äº’ï¼Œå»ä½¿ç”¨dockerçš„èƒ½åŠ›ã€‚<img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20220730233109830.png"
	
	
	
	loading="lazy"
	
		alt="image-20220730233109830"
	
	
></p>
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œdockershimçš„ä½œç”¨ä¸ä¸€ä¸ªCRIå®ç°æ˜¯ä¸€æ ·çš„ã€‚å°½ç®¡ç›®å‰dockeråº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨äº†<code>containerd</code>ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦å¤šä¸€ä¸ªä¸­é—´ç¯èŠ‚ï¼Œç”¨dockerè°ƒç”¨containerdã€‚</p>
<p>è€Œk8sä¸­CRIä¹‹ä¸€<code>containerd</code>åˆ™ä¸ºk8sæä¾›äº†ç›´æ¥è°ƒç”¨containerdçš„èƒ½åŠ›ã€‚</p>
<blockquote>
<p>ç›®å‰ä¸»è¦çš„CRIå®ç°æœ‰ï¼š</p>
<ul>
<li>containerd</li>
<li>cri-o</li>
<li>cri-dockerd</li>
</ul>
</blockquote>
<p>æ­£å› å¦‚æ­¤ï¼Œk8sä¸å¿…å±€é™äºdockerè¿™ä¸€ç§è¿è¡Œæ—¶ï¼ŒCRIçš„èƒ½åŠ›å¯ä»¥è®©k8sä½¿ç”¨ç‰¹æ€§ä¸åŒçš„å®¹å™¨è¿è¡Œæ—¶ã€‚</p>
<h3 id="å¼ƒç”¨dockershimådockerè¿˜æœ‰ç”¨å—">å¼ƒç”¨dockershimåï¼ŒDockerè¿˜æœ‰ç”¨å—ï¼Ÿ</h3>
<p>å½“ç„¶ã€‚</p>
<p>åœ¨æˆ‘çš„å°è±¡é‡Œï¼Œdockerä»ç„¶æ˜¯ç›®å‰ä½¿ç”¨æœ€å¤šçš„å®¹å™¨æ‰“åŒ…æ„å»ºã€é•œåƒç®¡ç†å’Œè¿è¡Œå·¥å…·ã€‚docker hubæœ‰ä¸°å¯Œé•œåƒèµ„æºã€æœ‰å¾ˆå¤šå¼€å‘è€…åœ¨ä½¿ç”¨dockerå»æ„å»ºè‡ªå·±åº”ç”¨é•œåƒã€‚ä½¿ç”¨<code>docker build</code>æ‰“åŒ…çš„é•œåƒä¾ç„¶ç¬¦åˆCRIçš„æ ‡å‡†ï¼ˆå› ä¸ºå·²ç»å®¹å™¨è¿è¡Œæ—¶ä»¥åŠæœ‰æ ‡å‡†åŒ–ç»„ç»‡OCIä¸ºå…¶åˆ¶å®šè§„èŒƒäº†ï¼‰ã€‚</p>
<p>åªä¸è¿‡ï¼ŒåŸæ¥ä¸ºdocker engineåšé€‚é…å·¥ä½œç°åœ¨å·²ç»ä¸å±äºk8sç¤¾åŒºçš„ç®¡è¾–èŒƒå›´ï¼Œéœ€è¦å…¶ä»–ç¤¾åŒºè‡ªå·±å»æŒ‰ç…§CRIçš„æ ‡å‡†ï¼Œä¸ºdocker engineç¼–å†™æ¥å…¥k8sçš„â€œè½¬æ¥å¤´â€ã€‚å› æ­¤ï¼Œå°±æœ‰äº†<code>cri-dockerd</code>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ç»§ç»­ä½¿ç”¨åœ¨k8sä¸­ä½¿ç”¨dockerï¼Œå°±å¿…é¡»ä½¿ç”¨<code>cri-dockerd</code>ä½œä¸ºé€‚é…å™¨ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡CRIæ¥ä½¿ç”¨docker engineã€‚</p>
<h2 id="åœ¨æ–°ç‰ˆæœ¬é›†ç¾¤ä¸­ä½¿ç”¨cri-dockerd">åœ¨æ–°ç‰ˆæœ¬é›†ç¾¤ä¸­ä½¿ç”¨cri-dockerd</h2>
<p>ä¹‹å‰çš„åšå®¢ä¸­æˆ‘ä»¬åˆ†äº«åˆ°ï¼Œæ­å»ºé›†ç¾¤åªéœ€è¦èŠ‚ç‚¹ä¸Šæœ‰docker engineå°±å¯ä»¥ï¼Œç„¶åæŒ‰ç…§<code>kubeadm</code>ï¼Œ<code>kubelet</code>ï¼Œ<code>kubectl</code>å°±å¯ä»¥äº†ï¼Œä¸ä¼šå»åˆ»æ„ã€æ˜¾å¼çš„é…ç½®å®¹å™¨è¿è¡Œæ—¶ã€‚é‚£æ˜¯å› ä¸ºk8så†…ç½®çš„dockershimè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªå·¥ä½œã€‚</p>
<p>åœ¨1.24.0ä¹‹åï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºé›†ç¾¤ä¹‹å‰ï¼Œä¹Ÿè¦åƒå®‰è£…CNIé‚£æ ·å…ˆé…ç½®æˆ‘ä»¬çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæ‰å¯ä»¥æ­£å¸¸åˆå§‹åŒ–k8sé›†ç¾¤ã€‚</p>
<h3 id="å®‰è£…å¹¶é…ç½®cri-dockerd">å®‰è£…å¹¶é…ç½®cri-dockerd</h3>
<p>:warning:è¿™éœ€è¦èŠ‚ç‚¹ä¸Šæœ‰æ­£å¸¸è¿è¡Œçš„docker engineã€‚åŒæ—¶è¦åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…cri-dockerdã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨Ubuntu22.04ä½œä¸ºç¯å¢ƒï¼Œç›´æ¥åœ¨<a class="link" href="https://github.com/Mirantis/cri-dockerd/releases"  target="_blank" rel="noopener"
    >release</a>ä¸‹è½½æ„å»ºå¥½çš„å¯¹åº”Ubuntuç‰ˆæœ¬çš„<code>.deb</code>å®‰è£…æ–‡ä»¶ã€‚</p>
<p><img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/202207311437400.png"
	
	
	
	loading="lazy"
	
		alt="image-20220731143731223"
	
	
></p>
<p>ç„¶åï¼Œè¿›è¡Œå®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; dpkg -i cri-dockerd_0.2.3.3-0.ubuntu-jammy_amd64.deb
</span></span><span style="display:flex;"><span>Selecting previously unselected package cri-dockerd.
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Reading database ... <span style="color:#ae81ff">212454</span> files and directories currently installed.<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Preparing to unpack cri-dockerd_0.2.3.3-0.ubuntu-jammy_amd64.deb ...
</span></span><span style="display:flex;"><span>Unpacking cri-dockerd <span style="color:#f92672">(</span>0.2.3~3-0~ubuntu-jammy<span style="color:#f92672">)</span> ...
</span></span><span style="display:flex;"><span>Setting up cri-dockerd <span style="color:#f92672">(</span>0.2.3~3-0~ubuntu-jammy<span style="color:#f92672">)</span> ...
</span></span><span style="display:flex;"><span>Created symlink /etc/systemd/system/multi-user.target.wants/cri-docker.service â†’ /lib/systemd/system/cri-docker.service.
</span></span><span style="display:flex;"><span>Created symlink /etc/systemd/system/sockets.target.wants/cri-docker.socket â†’ /lib/systemd/system/cri-docker.socket.
</span></span></code></pre></div><p>å®‰è£…logé‡Œæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„ä¿¡æ¯ç‚¹ï¼š</p>
<p><code>Created symlink /etc/systemd/system/multi-user.target.wants/cri-docker.service â†’ /lib/systemd/system/cri-docker.service.</code></p>
<p><code>Created symlink /etc/systemd/system/sockets.target.wants/cri-docker.socket â†’ /lib/systemd/system/cri-docker.socket.</code></p>
<blockquote>
<p><code>sysmlink</code>æ˜¯Linuxä¸­çš„ä¸€ç§æ–‡ä»¶ç±»å‹ï¼Œç§°ä¸ºâ€œç¬¦å·é“¾æ¥â€ã€â€œè½¯é“¾æ¥â€ï¼ŒæŒ‡å‘è®¡ç®—æœºä¸Šå¦ä¸€ä¸ªæ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ã€‚ç±»ä¼¼äºWindowsä¸­çš„å¿«æ·æ–¹å¼ã€‚è¿™ç§é“¾æ¥æ–‡ä»¶è®°å½•äº†è¢«é“¾æ¥æ–‡ä»¶çš„è·¯å¾„ï¼Œæ›´æ–¹ä¾¿çš„è®¿é—®æŸäº›æ–‡ä»¶ã€‚</p>
</blockquote>
<p>åœ¨å®‰è£…cri-dockerdæ—¶ï¼Œä¸º<code>cri-docker.service</code>ï¼Œå’Œ<code>cri-docker.socket</code>åˆ›å»ºäº†è½¯é“¾æ¥ã€‚</p>
<p>å®‰è£…åï¼Œæˆ‘ä»¬æ‰§è¡Œ<code>cri-dockerd -h</code> äº†è§£ä¸€ä¸‹åŸºæœ¬ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; cri-dockerd -h
</span></span><span style="display:flex;"><span>CRI that connects to the Docker Daemon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  cri-dockerd <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Flags:
</span></span><span style="display:flex;"><span>      --buildinfo                               Prints the build information about cri-dockerd
</span></span><span style="display:flex;"><span>      --cni-bin-dir string                      &lt;Warning: Alpha feature&gt; A comma-separated list of full paths of directories in which to search <span style="color:#66d9ef">for</span> CNI plugin binaries. <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;/opt/cni/bin&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --cni-cache-dir string                    &lt;Warning: Alpha feature&gt; The full path of the directory in which CNI should store cache files. <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;/var/lib/cni/cache&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --cni-conf-dir string                     &lt;Warning: Alpha feature&gt; The full path of the directory in which to search <span style="color:#66d9ef">for</span> CNI config files <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;/etc/cni/net.d&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --container-runtime-endpoint string       The endpoint of backend runtime service. Currently unix socket and tcp endpoints are supported on Linux, <span style="color:#66d9ef">while</span> npipe and tcp endpoints are supported on windows.  Examples:<span style="color:#e6db74">&#39;unix:///var/run/cri-dockerd.sock&#39;</span>, <span style="color:#e6db74">&#39;npipe:////./pipe/cri-dockerd&#39;</span> <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;unix:///var/run/cri-dockerd.sock&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --cri-dockerd-root-directory string       Path to the cri-dockerd root directory. <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;/var/lib/cri-dockerd&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --docker-endpoint string                  Use this <span style="color:#66d9ef">for</span> the docker endpoint to communicate with. <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;unix:///var/run/docker.sock&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --hairpin-mode HairpinMode                &lt;Warning: Alpha feature&gt; The mode of hairpin to use. <span style="color:#f92672">(</span>default none<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  -h, --help                                    Help <span style="color:#66d9ef">for</span> cri-dockerd
</span></span><span style="display:flex;"><span>      --image-pull-progress-deadline duration   If no pulling progress is made before this deadline, the image pulling will be cancelled. <span style="color:#f92672">(</span>default 1m0s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --ipv6-dual-stack                         Enable IPv6 dual stack support
</span></span><span style="display:flex;"><span>      --log-level string                        The log level <span style="color:#66d9ef">for</span> cri-docker <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;info&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --network-plugin string                   &lt;Warning: Alpha feature&gt; The name of the network plugin to be invoked <span style="color:#66d9ef">for</span> various events in kubelet/pod lifecycle.
</span></span><span style="display:flex;"><span>      --network-plugin-mtu int32                &lt;Warning: Alpha feature&gt; The MTU to be passed to the network plugin, to override the default. Set to <span style="color:#ae81ff">0</span> to use the default <span style="color:#ae81ff">1460</span> MTU.
</span></span><span style="display:flex;"><span>      --pod-cidr string                         The CIDR to use <span style="color:#66d9ef">for</span> pod IP addresses, only used in standalone mode.  In cluster mode, this is obtained from the master. For IPv6, the maximum number of IP<span style="color:#960050;background-color:#1e0010">&#39;</span>s allocated is <span style="color:#ae81ff">65536</span>
</span></span><span style="display:flex;"><span>      --pod-infra-container-image string        The image whose network/ipc namespaces containers in each pod will use <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --runtime-cgroups string                  Optional absolute name of cgroups to create and run the runtime in.
</span></span><span style="display:flex;"><span>      --version                                 Prints the version of cri-dockerd
</span></span></code></pre></div><p>ä»â€œCRI that connects to the Docker Daemonâ€ä¸­çœ‹åˆ°ï¼Œcri-dockerdçš„ä½œç”¨æ˜¯è¿æ¥èŠ‚ç‚¹ä¸Šçš„docker daemonçš„ï¼Œç„¶åk8så†è¿æ¥cri-dockerdï¼Œå°±èƒ½ä½¿ç”¨dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶äº†ã€‚</p>
<ul>
<li><code>--cni-bin-dir string</code></li>
<li><code>--cni-cache-dir string</code></li>
<li><code>--cni-conf-dir string</code></li>
</ul>
<p>ä¸Šé¢ä¸‰ä¸ªå‚æ•°æ˜¯å…³äºå®¹å™¨ç½‘ç»œçš„ï¼Œæš‚æ—¶åœ¨alphaé˜¶æ®µã€‚</p>
<ul>
<li><code>--container-runtime-endpoint</code></li>
</ul>
<p>è¿™ä¸ªå‚æ•°éœ€è¦æˆ‘ä»¬æ³¨æ„ï¼Œå®ƒæŒ‡å®šäº†k8séœ€è¦è¿æ¥CRIç«¯ç‚¹ï¼Œé»˜è®¤æ˜¯<code>unix:///var/run/cri-dockerd.sock</code>ï¼Œåœ¨åé¢é…ç½®kubeadm configæ—¶éœ€è¦ç”¨åˆ°ã€‚</p>
<ul>
<li><code>--docker-endpoint string</code></li>
</ul>
<p>è¿™ä¸ªå‚æ•°å°±æ˜¯cri-dockerdè¦å»è¿æ¥çš„docker daemonçš„ç«¯ç‚¹ï¼Œæ¥ä½¿ç”¨dockerçš„èƒ½åŠ›ã€‚</p>
<ul>
<li><code>--pod-cidr string</code></li>
</ul>
<p>è¯¥å‚æ•°åªæœ‰åœ¨å•èŠ‚ç‚¹éƒ¨ç½²æ—¶æ‰ä¼šç”¨åˆ°ï¼Œåœ¨é›†ç¾¤ç¯å¢ƒä¸‹cri-dockerdé€šè¿‡è·å–master nodeçš„ä¿¡æ¯çŸ¥æ™“podçš„cidråˆ’åˆ†ã€‚</p>
<ul>
<li><code>--pod-infra-container-image</code></li>
</ul>
<p>è¯¥å‚æ•°å¯ä»¥ç”¨æ¥è®¾ç½®Podä¸­çš„pauseå®¹å™¨çš„é•œåƒç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨<code>k8s.gcr.io/pause:3.6</code>è¿™ä¸ªé•œåƒã€‚ä½†æ˜¯åœ¨k8s1.24ä¸­ï¼Œåº”è¯¥ä½¿ç”¨3.7ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¦æ¢æˆaliyuné•œåƒï¼Œåœ¨åé¢éœ€è¦è®¾ç½®ã€‚</p>
<h3 id="ä¿®æ”¹kubeadm-configæ–‡ä»¶">ä¿®æ”¹kubeadm configæ–‡ä»¶</h3>
<p>æˆ‘å…ˆå¯¼å‡º<code>kubeadm</code>é»˜è®¤çš„å¯åŠ¨é…ç½®æ–‡ä»¶ã€‚</p>
<p><code>kubeadm config print init-defaults &gt; kubeadm1.24.conf</code></p>
<p>ç„¶ååšä¸€äº›ä¿®æ”¹ï¼Œæˆ‘çš„ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>bootstrapTokens:
</span></span><span style="display:flex;"><span>- groups:
</span></span><span style="display:flex;"><span>  - system:bootstrappers:kubeadm:default-node-token
</span></span><span style="display:flex;"><span>  token: abcdef.0123456789abcdef
</span></span><span style="display:flex;"><span>  ttl: 24h0m0s
</span></span><span style="display:flex;"><span>  usages:
</span></span><span style="display:flex;"><span>  - signing
</span></span><span style="display:flex;"><span>  - authentication
</span></span><span style="display:flex;"><span>kind: InitConfiguration
</span></span><span style="display:flex;"><span>localAPIEndpoint:
</span></span><span style="display:flex;"><span>  advertiseAddress: 192.168.153.21
</span></span><span style="display:flex;"><span>  bindPort: <span style="color:#ae81ff">6443</span>
</span></span><span style="display:flex;"><span>nodeRegistration:
</span></span><span style="display:flex;"><span>  criSocket: unix:///var/run/cri-dockerd.sock
</span></span><span style="display:flex;"><span>  imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>  name: nm
</span></span><span style="display:flex;"><span>  taints: null
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiServer:
</span></span><span style="display:flex;"><span>  timeoutForControlPlane: 4m0s
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style="display:flex;"><span>clusterName: kubernetes
</span></span><span style="display:flex;"><span>controllerManager: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>dns: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>  local:
</span></span><span style="display:flex;"><span>    dataDir: /var/lib/etcd
</span></span><span style="display:flex;"><span>imageRepository: registry.aliyuncs.com/google_containers
</span></span><span style="display:flex;"><span>kind: ClusterConfiguration
</span></span><span style="display:flex;"><span>kubernetesVersion: 1.24.0
</span></span><span style="display:flex;"><span>networking:
</span></span><span style="display:flex;"><span>  dnsDomain: cluster.local
</span></span><span style="display:flex;"><span>  serviceSubnet: 10.96.0.0/12
</span></span><span style="display:flex;"><span>  podSubnet: 10.5.0.0/16
</span></span><span style="display:flex;"><span>scheduler: <span style="color:#f92672">{}</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„å‡ ä¸ªç‚¹æœ‰ï¼š</p>
<ul>
<li><code>advertiseAddress: 192.168.153.21</code>ï¼šè®¾ç½®æ§åˆ¶å¹³é¢API Serverçš„åœ°å€å’Œç«¯å£ã€‚</li>
<li><code>criSocket: unix:///var/run/cri-dockerd.sock</code>ï¼šè¿™éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼ŒcriSocketå°±æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´çš„cri-dockerdä¸­çš„<code>--container-runtime-endpoint</code>å‚æ•°ï¼Œå¦‚æœä½¿ç”¨äº†åˆ«çš„å®¹å™¨è¿è¡Œæ—¶è¿™é‡Œä¹Ÿè¦ç›¸åº”ä¿®æ”¹ã€‚</li>
<li><code>name: nm</code>ï¼šæœ¬æœºçš„hostnameã€‚</li>
<li><code>imageRepository: registry.aliyuncs.com/google_containers</code>ï¼šå›½å†…ç”¨aliyunçš„é•œåƒã€‚</li>
<li><code>podSubnet: 10.5.0.0/16</code>ï¼šPod cidrä¿¡æ¯ã€‚</li>
</ul>
<h3 id="å¯åŠ¨é›†ç¾¤å¯åŠ¨å¤±è´¥">å¯åŠ¨é›†ç¾¤(å¯åŠ¨å¤±è´¥)</h3>
<p>ç„¶åæˆ‘ä»¬å°è¯•å¯åŠ¨é›†ç¾¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># kubeadm init --config ../create-cluster/kubeadm1.24.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Kubernetes version: v1.24.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: missing optional cgroups: blkio
</span></span><span style="display:flex;"><span>error execution phase preflight: <span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Some fatal errors occurred:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">[</span>ERROR CRI<span style="color:#f92672">]</span>: container runtime is not running: output: time<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2022-07-31T15:41:42+08:00&#34;</span> level<span style="color:#f92672">=</span>debug msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;get runtime connection&#34;</span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2022-07-31T15:41:42+08:00&#34;</span> level<span style="color:#f92672">=</span>fatal msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;unable to determine runtime API version: rpc error: code = Unavailable desc = connection error: desc = \&#34;transport: Error while dialing dial unix /var/run/cri-dockerd.sock: connect: connection refused\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>, error: exit status <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> If you know what you are doing, you can make a check non-fatal with <span style="color:#e6db74">`</span>--ignore-preflight-errors<span style="color:#f92672">=</span>...<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>To see the stack trace of this error execute with --v<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> or higher
</span></span></code></pre></div><p>å‘ç°æŠ¥é”™äº†<code>level=fatal msg=&quot;unable to determine runtime API version: rpc error: code = Unavailable desc = connection error: desc = \&quot;transport: Error while dialing dial unix /var/run/cri-dockerd.sock: connect: connection refused\&quot;</code>ã€‚æˆ‘ä»¬çš„socketæ²¡æœ‰è¿ä¸Šã€‚</p>
<p>åŸå› å°±æ˜¯ï¼Œ<strong>æˆ‘ä»¬å®‰è£…äº†cri-dockerdåï¼Œå®ƒå¹¶ä¸ä¼šåƒsystemctlæ‰€ç®¡ç†çš„serviceï¼Œæˆ–è€…å®ˆæŠ¤è¿›ç¨‹é‚£æ ·è‡ªåŠ¨é©»ç•™åœ¨æœ¬æœºä¸Šã€‚æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨çš„å¯åŠ¨cri-dockerdã€‚</strong></p>
<p>æ‰€ä»¥ï¼Œéœ€è¦æ‰‹åŠ¨è¿è¡Œcri-dockerdï¼Œå¹¶ä¸”æ·»åŠ <code>--pod-infra-container-image</code>å‚æ•°ã€‚ï¼ˆä½¿ç”¨<code>kubeadm config images list --config kubeadm1.24.conf</code>å¯ä»¥çŸ¥é“éœ€è¦çš„é•œåƒç‰ˆæœ¬ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; cri-dockerd --pod-infra-container-image<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers/pause:3.7
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Connecting to docker on the Endpoint unix:///var/run/docker.sock 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Start docker client with request timeout 0s  
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Hairpin mode is set to none                  
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker cri networking managed by network plugin kubernetes.io/no-op 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker Info: &amp;<span style="color:#f92672">{</span>ID:HEPZ:PXCZ:XHZR:SKBX:TJL5:EG5L:U6P3:PI5A:PVZZ:ASKB:QJUC:QEDR Containers:2 ContainersRunning:1 ContainersPaused:0 ContainersStopped:1 Images:13 Driver:overlay2 DriverStatus:<span style="color:#f92672">[[</span>Backing Filesystem extfs<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Supports d_type true<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Native Overlay Diff true<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>userxattr false<span style="color:#f92672">]]</span> SystemStatus:<span style="color:#f92672">[]</span> Plugins:<span style="color:#f92672">{</span>Volume:<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span> Network:<span style="color:#f92672">[</span>bridge host ipvlan macvlan null overlay<span style="color:#f92672">]</span> Authorization:<span style="color:#f92672">[]</span> Log:<span style="color:#f92672">[</span>awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog<span style="color:#f92672">]}</span> MemoryLimit:true SwapLimit:true KernelMemory:false KernelMemoryTCP:false CPUCfsPeriod:true CPUCfsQuota:true CPUShares:true CPUSet:true PidsLimit:true IPv4Forwarding:true BridgeNfIptables:true BridgeNfIP6tables:true Debug:false NFd:31 OomKillDisable:false NGoroutines:39 SystemTime:2022-07-31T15:49:40.481000763+08:00 LoggingDriver:json-file CgroupDriver:systemd NEventsListener:0 KernelVersion:5.15.0-41-generic OperatingSystem:Ubuntu 22.04 LTS OSType:linux Architecture:x86_64 IndexServerAddress:https://index.docker.io/v1/ RegistryConfig:0xc0001de540 NCPU:4 MemTotal:8302116864 GenericResources:<span style="color:#f92672">[]</span> DockerRootDir:/var/lib/docker HTTPProxy: HTTPSProxy: NoProxy: Name:nm Labels:<span style="color:#f92672">[]</span> ExperimentalBuild:false ServerVersion:20.10.17 ClusterStore: ClusterAdvertise: Runtimes:map<span style="color:#f92672">[</span>io.containerd.runc.v2:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}</span> io.containerd.runtime.v1.linux:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}</span> runc:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}]</span> DefaultRuntime:runc Swarm:<span style="color:#f92672">{</span>NodeID: NodeAddr: LocalNodeState:inactive ControlAvailable:false Error: RemoteManagers:<span style="color:#f92672">[]</span> Nodes:0 Managers:0 Cluster:&lt;nil&gt; Warnings:<span style="color:#f92672">[]}</span> LiveRestoreEnabled:false Isolation: InitBinary:docker-init ContainerdCommit:<span style="color:#f92672">{</span>ID:10c12954828e7c7c9b6e0ea9b0c02b01407d3ae1 Expected:10c12954828e7c7c9b6e0ea9b0c02b01407d3ae1<span style="color:#f92672">}</span> RuncCommit:<span style="color:#f92672">{</span>ID:v1.1.2-0-ga916309 Expected:v1.1.2-0-ga916309<span style="color:#f92672">}</span> InitCommit:<span style="color:#f92672">{</span>ID:de40ad0 Expected:de40ad0<span style="color:#f92672">}</span> SecurityOptions:<span style="color:#f92672">[</span>name<span style="color:#f92672">=</span>apparmor name<span style="color:#f92672">=</span>seccomp,profile<span style="color:#f92672">=</span>default name<span style="color:#f92672">=</span>cgroupns<span style="color:#f92672">]</span> ProductLicense: Warnings:<span style="color:#f92672">[]}</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Setting cgroupDriver systemd                 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker cri received runtime config &amp;RuntimeConfig<span style="color:#f92672">{</span>NetworkConfig:&amp;NetworkConfig<span style="color:#f92672">{</span>PodCidr:,<span style="color:#f92672">}</span>,<span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Starting the GRPC backend <span style="color:#66d9ef">for</span> the Docker CRI interface. 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Start cri-dockerd grpc backend
</span></span></code></pre></div><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå®ƒå·²ç»è¿ä¸Šäº†dockerçš„endpointã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬å†å¦èµ·ä¸€ä¸ªç»ˆç«¯ï¼Œå¯åŠ¨é›†ç¾¤ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„ï¼Œåœ¨æ¸…ç†é›†ç¾¤æ—¶ï¼Œè¦æ·»åŠ ä¸€ä¸ªsocketå‚æ•°ï¼Œå¦‚<code>kubeadm reset --cri-socket unix:///var/run/cri-dockerd.sock</code>ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubeadm init --config kubeadm1.24.3.conf 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>init<span style="color:#f92672">]</span> Using Kubernetes version: v1.24.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: missing optional cgroups: blkio
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Pulling images required <span style="color:#66d9ef">for</span> setting up a Kubernetes cluster
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> This might take a minute or two, depending on the speed of your internet connection
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> You can also perform this action in beforehand using <span style="color:#e6db74">&#39;kubeadm config images pull&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>certs<span style="color:#f92672">]</span> Using certificateDir folder <span style="color:#e6db74">&#34;/etc/kubernetes/pki&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>åœ¨cri-dockerdçš„ç»ˆç«¯ä¸­ï¼Œæœ‰äº†æ–°çš„è¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Start cri-dockerd grpc backend               
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0157<span style="color:#f92672">]</span> Will attempt to re-write config file /var/lib/docker/containers/000f099fa98530c39e69458881c051f25200feb4f25dfd3d8f02f7444e6763ac/resolv.conf as <span style="color:#f92672">[</span>nameserver 192.168.153.2 nameserver 192.168.153.2 search <span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0157<span style="color:#f92672">]</span> Will attempt to re-write config file /var/lib/docker/containers/ed0aa34e77adbf4ff444998b75e2365f1ebe44e831cdf4c55d3eecd4b6582958/resolv.conf as <span style="color:#f92672">[</span>nameserver 192.168.153.2 nameserver 192.168.153.2 search <span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0157<span style="color:#f92672">]</span> Will attempt to re-write config file /var/lib/docker/containers/3431d46d839451adc30f1c44994990daed5b24899959aae34b5cfd3d5c695fc6/resolv.conf as <span style="color:#f92672">[</span>nameserver 192.168.153.2 nameserver 192.168.153.2 search <span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0157<span style="color:#f92672">]</span> Will attempt to re-write config file /var/lib/docker/containers/50ae6ccb6e7c1420f58c1873bf2c17e291a26597a3b042b0df86a1ef2729470c/resolv.conf as <span style="color:#f92672">[</span>nameserver 192.168.153.2 nameserver 192.168.153.2 search <span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>0167<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc00098ea80 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>0168<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc00098f440 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>0168<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc000791b00 linux<span style="color:#f92672">}</span>    
</span></span></code></pre></div><p>ç„¶è€Œè¿™é‡Œè¿˜æŠ¥å‡ºä¸€äº›å¥‡æ€ªçš„é”™è¯¯ã€‚</p>
<p>æˆ‘ä»¬æŸ¥çœ‹dockerå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; docker container ls
</span></span><span style="display:flex;"><span>CONTAINER ID   IMAGE                                               COMMAND                  CREATED         STATUS         PORTS                                       NAMES
</span></span><span style="display:flex;"><span>bbded4be83db   a4ca41631cc7                                        <span style="color:#e6db74">&#34;/coredns -conf /etcâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_coredns_coredns-74586cf9b6-s6n6g_kube-system_68e930db-ac76-4995-bef2-a9f094b5cf88_0
</span></span><span style="display:flex;"><span>173154bfdc43   a4ca41631cc7                                        <span style="color:#e6db74">&#34;/coredns -conf /etcâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_coredns_coredns-74586cf9b6-wstwx_kube-system_178e7a4e-3c35-42e6-b78b-1053274d9d4d_0
</span></span><span style="display:flex;"><span>fb2810fe84a3   77b49675beae                                        <span style="color:#e6db74">&#34;/usr/local/bin/kubeâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_kube-proxy_kube-proxy-fpfq7_kube-system_3a52d7e5-ffa8-4193-a2de-948861818bf0_0
</span></span><span style="display:flex;"><span>640f6546ff97   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_coredns-74586cf9b6-s6n6g_kube-system_68e930db-ac76-4995-bef2-a9f094b5cf88_0
</span></span><span style="display:flex;"><span>8933a7f18e54   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_coredns-74586cf9b6-wstwx_kube-system_178e7a4e-3c35-42e6-b78b-1053274d9d4d_0
</span></span><span style="display:flex;"><span>c2319d389da4   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_kube-proxy-fpfq7_kube-system_3a52d7e5-ffa8-4193-a2de-948861818bf0_0
</span></span><span style="display:flex;"><span>c441aae26e22   88784fb4ac2f                                        <span style="color:#e6db74">&#34;kube-controller-manâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_kube-controller-manager_kube-controller-manager-nm_kube-system_0b57267fec9fa21f5d899c064341d122_0
</span></span><span style="display:flex;"><span>c2251251c6be   e3ed7dee73e9                                        <span style="color:#e6db74">&#34;kube-scheduler --auâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_kube-scheduler_kube-scheduler-nm_kube-system_4b1a2622b0a7caad68556441288e8374_0
</span></span><span style="display:flex;"><span>90df81c294fc   aebe758cef4c                                        <span style="color:#e6db74">&#34;etcd --advertise-clâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_etcd_etcd-nm_kube-system_c305f8ecb58a3de0b142aa31e3c6e6cc_0
</span></span><span style="display:flex;"><span>d14f4a822e37   529072250ccc                                        <span style="color:#e6db74">&#34;kube-apiserver --adâ€¦&#34;</span>   <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_kube-apiserver_kube-apiserver-nm_kube-system_a38fd4cf236ff9d9bba5bb8f006ffdfd_0
</span></span><span style="display:flex;"><span>000f099fa985   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_kube-scheduler-nm_kube-system_4b1a2622b0a7caad68556441288e8374_0
</span></span><span style="display:flex;"><span>50ae6ccb6e7c   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_kube-controller-manager-nm_kube-system_0b57267fec9fa21f5d899c064341d122_0
</span></span><span style="display:flex;"><span>ed0aa34e77ad   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_kube-apiserver-nm_kube-system_a38fd4cf236ff9d9bba5bb8f006ffdfd_0
</span></span><span style="display:flex;"><span>3431d46d8394   registry.aliyuncs.com/google_containers/pause:3.7   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">2</span> minutes ago   Up <span style="color:#ae81ff">2</span> minutes                                               k8s_POD_etcd-nm_kube-system_c305f8ecb58a3de0b142aa31e3c6e6cc_0
</span></span></code></pre></div><p>ç³»ç»Ÿçš„ç»„ä»¶éƒ½å¯åŠ¨äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; kubectl get cs
</span></span><span style="display:flex;"><span>Warning: v1 ComponentStatus is deprecated in v1.19+
</span></span><span style="display:flex;"><span>NAME                 STATUS    MESSAGE                         ERROR
</span></span><span style="display:flex;"><span>scheduler            Healthy   ok                              
</span></span><span style="display:flex;"><span>controller-manager   Healthy   ok                              
</span></span><span style="display:flex;"><span>etcd-0               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span>,<span style="color:#e6db74">&#34;reason&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>&gt; kubectl get pod -A
</span></span><span style="display:flex;"><span>NAMESPACE     NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-system   coredns-74586cf9b6-vpdp5     1/1     Running   <span style="color:#ae81ff">0</span>          33s
</span></span><span style="display:flex;"><span>kube-system   coredns-74586cf9b6-zdfpw     1/1     Running   <span style="color:#ae81ff">0</span>          33s
</span></span><span style="display:flex;"><span>kube-system   etcd-nm                      1/1     Running   <span style="color:#ae81ff">0</span>          46s
</span></span><span style="display:flex;"><span>kube-system   kube-apiserver-nm            1/1     Running   <span style="color:#ae81ff">0</span>          49s
</span></span><span style="display:flex;"><span>kube-system   kube-controller-manager-nm   1/1     Running   <span style="color:#ae81ff">0</span>          49s
</span></span><span style="display:flex;"><span>kube-system   kube-proxy-gs9lq             1/1     Running   <span style="color:#ae81ff">0</span>          33s
</span></span><span style="display:flex;"><span>kube-system   kube-scheduler-nm            1/1     Running   <span style="color:#ae81ff">0</span>          46s
</span></span></code></pre></div><p>åŠ å…¥å·¥ä½œèŠ‚ç‚¹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubeadm join 192.168.153.21:6443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        --discovery-token-ca-cert-hash sha256:d1902aa47f486d6fd1d35f7fb92286ffaa39da0437ded9be8d2de5670d52a8ca
</span></span><span style="display:flex;"><span>Found multiple CRI endpoints on the host. Please define which one <span style="color:#66d9ef">do</span> you wish to use by setting the <span style="color:#e6db74">&#39;criSocket&#39;</span> field in the kubeadm configuration file: unix:///var/run/containerd/containerd.sock, unix:///var/run/cri-dockerd.sock
</span></span></code></pre></div><p>æˆ‘ä»¬å‘ç°è¿™é‡Œå‡ºç°äº†è¿è¡Œæ—¶å†²çªï¼Œéœ€è¦æŒ‡å®šï¼Œè¿™é‡Œå°±ç›´æ¥åœ¨å‘½ä»¤è¡ŒæŒ‡æ˜ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubeadm join 192.168.153.21:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:d1902aa47f486d6fd1d35f7fb92286ffaa39da0437ded9be8d2de5670d52a8ca --cri-socket unix:///var/run/cri-dockerd.sock
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Running pre-flight checks
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">[</span>WARNING SystemVerification<span style="color:#f92672">]</span>: missing optional cgroups: blkio
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> Reading configuration from the cluster...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>preflight<span style="color:#f92672">]</span> FYI: You can look at this config file with <span style="color:#e6db74">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Writing kubelet configuration to file <span style="color:#e6db74">&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Writing kubelet environment file with flags to file <span style="color:#e6db74">&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Starting the kubelet
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>kubelet-start<span style="color:#f92672">]</span> Waiting <span style="color:#66d9ef">for</span> the kubelet to perform the TLS Bootstrap...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This node has joined the cluster:
</span></span><span style="display:flex;"><span>* Certificate signing request was sent to apiserver and a response was received.
</span></span><span style="display:flex;"><span>* The Kubelet was informed of the new secure connection details.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Run <span style="color:#e6db74">&#39;kubectl get nodes&#39;</span> on the control-plane to see this node join the cluster.
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬çœ‹åˆ°èŠ‚ç‚¹å·²åŠ å…¥é›†ç¾¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; kubectl get nodes
</span></span><span style="display:flex;"><span>NAME   STATUS   ROLES           AGE     VERSION
</span></span><span style="display:flex;"><span>na     Ready    &lt;none&gt;          2m14s   v1.24.3
</span></span><span style="display:flex;"><span>nb     Ready    &lt;none&gt;          24s     v1.24.3
</span></span><span style="display:flex;"><span>nm     Ready    control-plane   7m33s   v1.24.3
</span></span></code></pre></div><p><strong>è¿™é‡Œæˆ‘ä¸è§£çš„æ˜¯ï¼Œä¹‹å‰è®¾ç½®CNIå‰ï¼Œcore-dnsçš„çŠ¶æ€æ˜¯pendingï¼Œè€Œä¸”èŠ‚ç‚¹çŠ¶æ€ä¹Ÿæ˜¯Not Readyã€‚ä½†æ˜¯ç°åœ¨å´çœ‹ä¼¼ä¸€åˆ‡æ­£å¸¸ã€‚</strong></p>
<p>æˆ‘ä»¬å…ˆä½¿ç”¨ç®€å•çš„flannelåšé›†ç¾¤ç½‘ç»œï¼Œæ³¨æ„ä¸è¦å¿˜è®°ä¿®æ”¹cidrä¸ºé›†ç¾¤åˆ›å»ºæ—¶æŒ‡å®šçš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubectl get pods -A
</span></span><span style="display:flex;"><span>NAMESPACE      NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-5v2vn        1/1     Running   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-bcgwm        1/1     Running   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-ctt4v        1/1     Running   <span style="color:#ae81ff">0</span>          41s
</span></span><span style="display:flex;"><span>kube-system    coredns-74586cf9b6-vpdp5     1/1     Running   <span style="color:#ae81ff">0</span>          14m
</span></span><span style="display:flex;"><span>kube-system    coredns-74586cf9b6-zdfpw     1/1     Running   <span style="color:#ae81ff">0</span>          14m
</span></span><span style="display:flex;"><span>kube-system    etcd-nm                      1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span><span style="display:flex;"><span>kube-system    kube-apiserver-nm            1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span><span style="display:flex;"><span>kube-system    kube-controller-manager-nm   1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-6px66             1/1     Running   <span style="color:#ae81ff">0</span>          9m56s
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-cc4fw             1/1     Running   <span style="color:#ae81ff">0</span>          8m6s
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-gs9lq             1/1     Running   <span style="color:#ae81ff">0</span>          14m
</span></span><span style="display:flex;"><span>kube-system    kube-scheduler-nm            1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span></code></pre></div><p>ç½‘ç»œCNIä¹Ÿæ­£å¸¸å·¥ä½œäº†ã€‚</p>
<p>ç„¶åæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªç®€å•çš„å¾®æœåŠ¡åº”ç”¨è¯•è¯•ã€‚</p>
<p>çœ‹ä¼¼ä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ˜¯æˆ‘å‘ç°é›†ç¾¤ç½‘ç»œå‡ºç°é—®é¢˜ï¼Œä¸èƒ½è®¿é—®serviceçš„æœåŠ¡ã€‚è€Œä¸”é€šè¿‡<code>-o wide</code>æŸ¥çœ‹Podå‘ç°ä»–ä»¬å¹¶ä¸åœ¨æˆ‘æ‰€æŒ‡å®šçš„CIDRç½‘æ®µï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªå¥‡æ€ªçš„172ç½‘æ®µã€‚</p>
<p>ç»“åˆä¸Šé¢çš„ï¼Œâ€œè¿˜æ²¡æœ‰éƒ¨ç½²CNIèŠ‚ç‚¹å’Œcore-dnså°±Readyâ€è¿™ä¸ªå¥‡æ€ªçš„ç°è±¡ã€‚æˆ‘è®¤ä¸ºcri-dockerdçš„ç½‘ç»œé…ç½®æœ‰é—®é¢˜ã€‚äºæ˜¯æˆ‘åˆè¯¦ç»†æŸ¥çœ‹çš„å‚è€ƒèµ„æ–™ï¼Œå‘ç°æœ‰ä¸€ä¸ªé…ç½®å’Œå‚è€ƒèµ„æ–™ä¸­çš„ä¸ä¸€æ ·ã€‚</p>
<p>å¹¶ä¸”æˆ‘ä»¬è¯¦ç»†æŸ¥çœ‹ä¸Šé¢çš„cri-dockerå¯åŠ¨æ—¥å¿—ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker cri networking managed by network plugin kubernetes.io/no-op
</span></span></code></pre></div><p>cri-dockerdçš„ç½‘ç»œæ˜¯ç”±<code>network plugin kubernetes.io/no-op</code>ç®¡ç†çš„ï¼Œè¿™æ˜¯ä¸ªå•¥ï¼Ÿ</p>
<h3 id="cni">CNI</h3>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸è®¨è®ºä¸‹kubernetes1.24ä¹‹åçš„å¦ä¸€ä¸ªé‡å¤§æ”¹å˜ï¼š<strong>åœ¨ Kubernetes 1.24 ä¹‹å‰ï¼ŒCNI æ’ä»¶ä¹Ÿå¯ä»¥ç”± kubelet ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•° <code>cni-bin-dir</code> å’Œ <code>network-plugin</code> ç®¡ç†ã€‚Kubernetes 1.24 ç§»é™¤äº†è¿™äº›å‘½ä»¤è¡Œå‚æ•°ï¼Œ CNI çš„ç®¡ç†ä¸å†æ˜¯ kubelet çš„å·¥ä½œã€‚</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œkubeletå·²ç»ä»ç®¡ç†CNIä¸­å¾—åˆ°äº†è§£æ”¾ã€‚è°æ¥ç®¡ç†cniå‘¢ï¼Ÿ</p>
<p>å®¹å™¨è¿è¡Œæ—¶ã€‚</p>
<p>åˆå›åˆ°å‚è€ƒèµ„æ–™ä¸­å¯¹cri-dockerdçš„é…ç½®ï¼Œæ˜¯è¿™æ ·å†™çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/cri-dockerd --network-plugin<span style="color:#f92672">=</span>cni --pod-infra-container-image<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers/pause:3.7
</span></span></code></pre></div><p>å¯¹<code>--network-plugin=cni</code>è¿›è¡Œäº†é…ç½®ã€‚ä¸Šè¿°cri-dockerdçš„å¯åŠ¨å‚æ•°ä¸­ï¼Œæœ‰ä¸€å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>--network-plugin string                   &lt;Warning: Alpha feature&gt; The name of the network plugin to be invoked <span style="color:#66d9ef">for</span> various events in kubelet/pod lifecycle.
</span></span></code></pre></div><p>äºæ˜¯æˆ‘æŒ‰ç…§è¿™ä¸ªæç¤ºæ‰¾åˆ°ä¸€ç¯‡è§£è¯»kubeleté…ç½®cniçš„åšæ–‡ï¼ŒWarningè¿™å¥è¯æ­£æ˜¯åŸæ¥åœ¨kubeletä»£ç ä¸­çš„ï¼ˆè§<a class="link" href="https://www.cnblogs.com/lianngkyle/p/15171630.html"  target="_blank" rel="noopener"
    >kubernetes/k8s CNIåˆ†æ-å®¹å™¨ç½‘ç»œæ¥å£åˆ†æ</a>ï¼‰ã€‚</p>
<p>kubeletç½‘ç»œæ’ä»¶æœ‰ä¸‹é¢ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>cni</li>
<li>kubenet</li>
<li>noopï¼šä¸é…ç½®ç½‘ç»œæ’ä»¶</li>
</ul>
<p>è¿™æ ·æˆ‘ä»¬å°±æ˜ç™½äº†ï¼Œåœ¨æœ€åˆå¯åŠ¨cri-dockerdçš„æ—¥å¿—å°±è¡¨ç¤ºæˆ‘ä»¬å¹¶æ²¡æœ‰ç»™cri-dockerdé…ç½®ç½‘ç»œæ’ä»¶<code>INFO[0000] Docker cri networking managed by network plugin kubernetes.io/no-op</code>ï¼Œç»“åˆå®ƒçš„å¯åŠ¨å‚æ•°<code>--network-plugin</code>ï¼Œå› æ­¤è¿™ä¸ªé—®é¢˜åº”è¯¥å°±æ˜¯å‡ºäºæ­¤ã€‚</p>
<h3 id="å†æ¬¡å¯åŠ¨é›†ç¾¤">å†æ¬¡å¯åŠ¨é›†ç¾¤</h3>
<p>æˆ‘ä»¬å…ˆæ¸…é™¤é›†ç¾¤ç¯å¢ƒï¼ŒåŒ…æ‹¬flannelç½‘ç»œç¯å¢ƒã€‚</p>
<p>åœ¨å¯åŠ¨cri-dockerdçš„å‘½ä»¤ä¸­åŠ ä¸Šç½‘ç»œæ’ä»¶å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; cri-dockerd --pod-infra-container-image<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers/pause:3.7 --network-plugin<span style="color:#f92672">=</span>cni
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Connecting to docker on the Endpoint unix:///var/run/docker.sock 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Start docker client with request timeout 0s  
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Hairpin mode is set to none                  
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Loaded network plugin cni                    
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker cri networking managed by network plugin cni 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker Info: &amp;<span style="color:#f92672">{</span>ID:HEPZ:PXCZ:XHZR:SKBX:TJL5:EG5L:U6P3:PI5A:PVZZ:ASKB:QJUC:QEDR Containers:16 ContainersRunning:12 ContainersPaused:0 ContainersStopped:4 Images:15 Driver:overlay2 DriverStatus:<span style="color:#f92672">[[</span>Backing Filesystem extfs<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Supports d_type true<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Native Overlay Diff true<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>userxattr false<span style="color:#f92672">]]</span> SystemStatus:<span style="color:#f92672">[]</span> Plugins:<span style="color:#f92672">{</span>Volume:<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span> Network:<span style="color:#f92672">[</span>bridge host ipvlan macvlan null overlay<span style="color:#f92672">]</span> Authorization:<span style="color:#f92672">[]</span> Log:<span style="color:#f92672">[</span>awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog<span style="color:#f92672">]}</span> MemoryLimit:true SwapLimit:true KernelMemory:false KernelMemoryTCP:false CPUCfsPeriod:true CPUCfsQuota:true CPUShares:true CPUSet:true PidsLimit:true IPv4Forwarding:true BridgeNfIptables:true BridgeNfIP6tables:true Debug:false NFd:89 OomKillDisable:false NGoroutines:83 SystemTime:2022-07-31T16:59:32.329402283+08:00 LoggingDriver:json-file CgroupDriver:systemd NEventsListener:0 KernelVersion:5.15.0-41-generic OperatingSystem:Ubuntu 22.04 LTS OSType:linux Architecture:x86_64 IndexServerAddress:https://index.docker.io/v1/ RegistryConfig:0xc000468a10 NCPU:4 MemTotal:8302116864 GenericResources:<span style="color:#f92672">[]</span> DockerRootDir:/var/lib/docker HTTPProxy: HTTPSProxy: NoProxy: Name:nm Labels:<span style="color:#f92672">[]</span> ExperimentalBuild:false ServerVersion:20.10.17 ClusterStore: ClusterAdvertise: Runtimes:map<span style="color:#f92672">[</span>io.containerd.runc.v2:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}</span> io.containerd.runtime.v1.linux:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}</span> runc:<span style="color:#f92672">{</span>Path:runc Args:<span style="color:#f92672">[]}]</span> DefaultRuntime:runc Swarm:<span style="color:#f92672">{</span>NodeID: NodeAddr: LocalNodeState:inactive ControlAvailable:false Error: RemoteManagers:<span style="color:#f92672">[]</span> Nodes:0 Managers:0 Cluster:&lt;nil&gt; Warnings:<span style="color:#f92672">[]}</span> LiveRestoreEnabled:false Isolation: InitBinary:docker-init ContainerdCommit:<span style="color:#f92672">{</span>ID:10c12954828e7c7c9b6e0ea9b0c02b01407d3ae1 Expected:10c12954828e7c7c9b6e0ea9b0c02b01407d3ae1<span style="color:#f92672">}</span> RuncCommit:<span style="color:#f92672">{</span>ID:v1.1.2-0-ga916309 Expected:v1.1.2-0-ga916309<span style="color:#f92672">}</span> InitCommit:<span style="color:#f92672">{</span>ID:de40ad0 Expected:de40ad0<span style="color:#f92672">}</span> SecurityOptions:<span style="color:#f92672">[</span>name<span style="color:#f92672">=</span>apparmor name<span style="color:#f92672">=</span>seccomp,profile<span style="color:#f92672">=</span>default name<span style="color:#f92672">=</span>cgroupns<span style="color:#f92672">]</span> ProductLicense: Warnings:<span style="color:#f92672">[]}</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Setting cgroupDriver systemd                 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Docker cri received runtime config &amp;RuntimeConfig<span style="color:#f92672">{</span>NetworkConfig:&amp;NetworkConfig<span style="color:#f92672">{</span>PodCidr:,<span style="color:#f92672">}</span>,<span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Starting the GRPC backend <span style="color:#66d9ef">for</span> the Docker CRI interface. 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>0000<span style="color:#f92672">]</span> Start cri-dockerd grpc backend     
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°<code>INFO[0000] Loaded network plugin cni</code>ã€‚</p>
<p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯é‡Œï¼Œåˆå§‹åŒ–é›†ç¾¤ï¼Œå¹¶å®‰è£…flannelæ’ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubectl get pods -A
</span></span><span style="display:flex;"><span>NAMESPACE     NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-system   coredns-74586cf9b6-2p28x     0/1     Pending   <span style="color:#ae81ff">0</span>          46s
</span></span><span style="display:flex;"><span>kube-system   coredns-74586cf9b6-lkrn6     0/1     Pending   <span style="color:#ae81ff">0</span>          46s
</span></span><span style="display:flex;"><span>kube-system   etcd-nm                      1/1     Running   <span style="color:#ae81ff">0</span>          58s
</span></span><span style="display:flex;"><span>kube-system   kube-apiserver-nm            1/1     Running   <span style="color:#ae81ff">0</span>          58s
</span></span><span style="display:flex;"><span>kube-system   kube-controller-manager-nm   1/1     Running   <span style="color:#ae81ff">0</span>          59s
</span></span><span style="display:flex;"><span>kube-system   kube-proxy-qcgfk             1/1     Running   <span style="color:#ae81ff">0</span>          46s
</span></span><span style="display:flex;"><span>kube-system   kube-scheduler-nm            1/1     Running   <span style="color:#ae81ff">0</span>          58s
</span></span><span style="display:flex;"><span>&gt; kubectl get node
</span></span><span style="display:flex;"><span>NAME   STATUS     ROLES           AGE     VERSION
</span></span><span style="display:flex;"><span>na     NotReady   &lt;none&gt;          10s     v1.24.3
</span></span><span style="display:flex;"><span>nb     NotReady   &lt;none&gt;          13s     v1.24.3
</span></span><span style="display:flex;"><span>nm     NotReady   control-plane   2m34s   v1.24.3
</span></span><span style="display:flex;"><span>&gt; kubectl apply -f ../network/flannel.yaml 
</span></span><span style="display:flex;"><span>namespace/kube-flannel created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>serviceaccount/flannel created
</span></span><span style="display:flex;"><span>configmap/kube-flannel-cfg created
</span></span><span style="display:flex;"><span>daemonset.apps/kube-flannel-ds created
</span></span><span style="display:flex;"><span>&gt; kubectl get pods -A
</span></span><span style="display:flex;"><span>NAMESPACE      NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-2rcs4        1/1     Running   <span style="color:#ae81ff">0</span>          19s
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-9szxg        1/1     Running   <span style="color:#ae81ff">0</span>          19s
</span></span><span style="display:flex;"><span>kube-flannel   kube-flannel-ds-cxw5k        1/1     Running   <span style="color:#ae81ff">0</span>          19s
</span></span><span style="display:flex;"><span>kube-system    coredns-74586cf9b6-2p28x     1/1     Running   <span style="color:#ae81ff">0</span>          3m22s
</span></span><span style="display:flex;"><span>kube-system    coredns-74586cf9b6-lkrn6     1/1     Running   <span style="color:#ae81ff">0</span>          3m22s
</span></span><span style="display:flex;"><span>kube-system    etcd-nm                      1/1     Running   <span style="color:#ae81ff">0</span>          3m34s
</span></span><span style="display:flex;"><span>kube-system    kube-apiserver-nm            1/1     Running   <span style="color:#ae81ff">0</span>          3m34s
</span></span><span style="display:flex;"><span>kube-system    kube-controller-manager-nm   1/1     Running   <span style="color:#ae81ff">0</span>          3m35s
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-7lsdq             1/1     Running   <span style="color:#ae81ff">0</span>          77s
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-fb96h             1/1     Running   <span style="color:#ae81ff">0</span>          74s
</span></span><span style="display:flex;"><span>kube-system    kube-proxy-qcgfk             1/1     Running   <span style="color:#ae81ff">0</span>          3m22s
</span></span><span style="display:flex;"><span>kube-system    kube-scheduler-nm            1/1     Running   <span style="color:#ae81ff">0</span>          3m34s
</span></span><span style="display:flex;"><span>&gt; kubectl get node
</span></span><span style="display:flex;"><span>NAME   STATUS   ROLES           AGE     VERSION
</span></span><span style="display:flex;"><span>na     Ready    &lt;none&gt;          76s     v1.24.3
</span></span><span style="display:flex;"><span>nb     Ready    &lt;none&gt;          79s     v1.24.3
</span></span><span style="display:flex;"><span>nm     Ready    control-plane   3m40s   v1.24.3
</span></span></code></pre></div><p>å®‰è£…flannelå‰ï¼Œcore-dnsä¸ºpendingã€èŠ‚ç‚¹ä¸ºNotReadyã€‚å®‰è£…åæ­£å¸¸ï¼Œè¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚</p>
<p>å¹¶ä¸”cri-dockerdä¸­ä¹Ÿæ‰“å°äº†cniçš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>3090<span style="color:#f92672">]</span> Using CNI configuration file /etc/cni/net.d/10-flannel.conflist 
</span></span><span style="display:flex;"><span>INFO<span style="color:#f92672">[</span>3095<span style="color:#f92672">]</span> Using CNI configuration file /etc/cni/net.d/10-flannel.conflist
</span></span></code></pre></div><p>å†æ¬¡éƒ¨ç½²ç”¨äºæµ‹è¯•çš„æœåŠ¡ï¼Œä¸€åˆ‡æ­£å¸¸ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; kubectl get pods -o wide -n cinema
</span></span><span style="display:flex;"><span>NAME                            READY   STATUS    RESTARTS   AGE   IP         NODE   NOMINATED NODE   READINESS GATES
</span></span><span style="display:flex;"><span>bookings-78c77d68f9-j5jzf       1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.2.2   na     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>mongo-deploy-57dc8c8f49-n6psq   1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.1.6   nb     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>movies-6fbc5986b9-vs6j8         1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.2.3   na     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>showtimes-56fc847b7-4bq87       1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.1.4   nb     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>users-6996b995d4-5l5tq          1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.2.4   na     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>website-867ff4b9dd-5zz49        1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.5.1.5   nb     &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span>&gt; kubectl get svc -o wide -n cinema
</span></span><span style="display:flex;"><span>NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>          AGE   SELECTOR
</span></span><span style="display:flex;"><span>bookings      ClusterIP   10.110.129.6    &lt;none&gt;        8080/TCP         27s   app<span style="color:#f92672">=</span>bookings
</span></span><span style="display:flex;"><span>mongodb-svc   ClusterIP   10.103.92.132   &lt;none&gt;        27017/TCP        27s   app<span style="color:#f92672">=</span>mongodb
</span></span><span style="display:flex;"><span>movies        ClusterIP   10.103.102.97   &lt;none&gt;        8080/TCP         27s   app<span style="color:#f92672">=</span>movies
</span></span><span style="display:flex;"><span>showtimes     ClusterIP   10.96.139.99    &lt;none&gt;        8080/TCP         27s   app<span style="color:#f92672">=</span>showtimes
</span></span><span style="display:flex;"><span>users         ClusterIP   10.106.152.98   &lt;none&gt;        8080/TCP         27s   app<span style="color:#f92672">=</span>users
</span></span><span style="display:flex;"><span>website       NodePort    10.96.103.3     &lt;none&gt;        8080:30021/TCP   27s   app<span style="color:#f92672">=</span>website
</span></span></code></pre></div><p><img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/202207311754304.png"
	
	
	
	loading="lazy"
	
		alt="image-20220731175441143"
	
	
></p>
<p>åˆ°è¿™é‡Œï¼Œ1.24.0ç‰ˆæœ¬çš„é›†ç¾¤å°±æ­£å¸¸éƒ¨ç½²Podå¹¶æä¾›æœåŠ¡äº†ã€‚</p>
<h2 id="ä¸€äº›é—®é¢˜">ä¸€äº›é—®é¢˜</h2>
<h3 id="cri-dockerdæŠ¥é”™">cri-dockerdæŠ¥é”™</h3>
<p>è™½ç„¶ç›®å‰åŠŸèƒ½ä¸Šçœ‹æ¥æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯cri-dockerdä¸€ç›´æ‰“å°é”™è¯¯ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>3404<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc0003c8900 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>3404<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc0005dcb00 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>3404<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc0003c9c40 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>3404<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc0005dd700 linux<span style="color:#f92672">}</span>    
</span></span><span style="display:flex;"><span>ERRO<span style="color:#f92672">[</span>3404<span style="color:#f92672">]</span> ContainerStats resp: <span style="color:#f92672">{</span>0xc0007be540 linux<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>æˆ‘å°è¯•åœ¨å½“å‰ç‰ˆæœ¬çš„æºç ä¸­éœ€è¦è¿™å¥æ—¥å¿—çš„è¾“å‡ºä½ç½®ï¼Œç»“æœæ²¡æœ‰å‘ç°ã€‚ç„¶ååœ¨ç¤¾åŒºä¸­æäº†<a class="link" href="https://github.com/Mirantis/cri-dockerd/issues/98"  target="_blank" rel="noopener"
    >è¿™ä¸ªissue</a>ã€‚è¿™ä¸ªé—®é¢˜å’Œç¤¾åŒºä¸­<a class="link" href="https://github.com/Mirantis/cri-dockerd/issues/85"  target="_blank" rel="noopener"
    >Lots of obscure error logging #85</a>é—®é¢˜å¤§æ¦‚æ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½æ˜¯ä¸€äº›æµ‹è¯•ä¸­çš„é—ç•™ï¼Œè¢«è¯¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šå»äº†ã€‚</p>
<p><img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20220801181830962.png"
	
	
	
	loading="lazy"
	
		alt="image-20220801181830962"
	
	
></p>
<p>å¥½åœ¨å®¹å™¨è¿è¡Œæ—¶çš„åŠŸèƒ½è²Œä¼¼æ²¡æœ‰å—å½±å“ã€‚</p>
<h3 id="cri-dockerdå¸¸é©»ä¸€ä¸ªç»ˆç«¯">cri-dockerdå¸¸é©»ä¸€ä¸ªç»ˆç«¯</h3>
<p>è¿™ç§æ–¹æ³•åœ¨å®‰è£…cri-dockerdæ—¶å°†å…¶è§†ä¸ºä¸€ä¸ªè½¯ä»¶ï¼Œå¿…é¡»æ‰‹åŠ¨å¯åŠ¨å®ƒï¼Œæ‰å¯ä»¥è®©å®ƒç›‘å¬socketå®ç°å’Œk8sä»¥åŠdockerçš„é€šä¿¡ã€‚åšæ–‡<a class="link" href="https://www.modb.pro/db/428370"  target="_blank" rel="noopener"
    >åŸºäºdockerå’Œcri-dockerdéƒ¨ç½²Kubernetes 1.24</a>ä¸­åˆ™æ˜¯ä½¿ç”¨äº†å¦ä¸€ç§æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ºæˆ‘æœ¬æ¬¡çš„æµ‹è¯•æä¾›äº†å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
<blockquote>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§cri-dockerdçš„æ–‡æ¡£ï¼Œæ‰‹åŠ¨ç¼–è¯‘ã€éƒ¨ç½²ã€‚</p>
</blockquote>
<p>åœ¨åšæ–‡<a class="link" href="https://www.modb.pro/db/428370"  target="_blank" rel="noopener"
    >åŸºäºdockerå’Œcri-dockerdéƒ¨ç½²Kubernetes 1.24</a>ä¸­ï¼Œä½œè€…çš„æ€è·¯ä¸<a class="link" href="https://github.com/Mirantis/cri-dockerd"  target="_blank" rel="noopener"
    >å®˜æ–¹çš„å®‰è£…æ€è·¯</a>æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå³ï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«systemctlç®¡ç†çš„serviceå’Œsocketå¯¹ã€‚è®©cri-dockerdåœ¨åå°å¯åŠ¨ï¼Œä¸ç”¨æ˜¾å¼å¯åŠ¨å¹¶å ç”¨ä¸€ä¸ªç»ˆç«¯ã€‚</p>
<p>å…¶ä¸­ï¼Œå…³é”®éƒ¨åˆ†å¦‚ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œå‡ºäºç³»ç»Ÿé€šç”¨æ€§ï¼Œä½¿ç”¨<a class="link" href="https://github.com/Mirantis/cri-dockerd/releases"  target="_blank" rel="noopener"
    >cri-dockerdçš„release</a>ä¸­çš„<code>.amd64.tgz</code>ç‰ˆæœ¬ã€‚</p>
<p><img src="https://picgo-lzl.oss-cn-beijing.aliyuncs.com/image-20220730234545013.png"
	
	
	
	loading="lazy"
	
		alt="image-20220730234545013"
	
	
></p>
<p>å°†æ–‡ä»¶è§£å‹ï¼Œå¹¶å°†é‡Œé¢çš„å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°<code>/usr/bin/</code>ä¸‹é¢ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; tar -xf cri-dockerd-0.2.3.amd64.tgz 
</span></span><span style="display:flex;"><span>&gt; cp cri-dockerd/cri-dockerd /usr/bin/
</span></span><span style="display:flex;"><span>&gt; chmod +x /usr/bin/cri-dockerd 
</span></span></code></pre></div><p>ç„¶åå¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œé…ç½®cri-dockerdçš„å¯åŠ¨æ–‡ä»¶ã€‚åœ¨<code>/usr/lib/systemd/system/cri-docker.service</code>ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>CRI Interface <span style="color:#66d9ef">for</span> Docker Application Container Engine
</span></span><span style="display:flex;"><span>Documentation<span style="color:#f92672">=</span>https://docs.mirantis.com
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network-online.target firewalld.service docker.service
</span></span><span style="display:flex;"><span>Wants<span style="color:#f92672">=</span>network-online.target
</span></span><span style="display:flex;"><span>Requires<span style="color:#f92672">=</span>cri-docker.socket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>notify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/cri-dockerd --network-plugin<span style="color:#f92672">=</span>cni --pod-infra-container-image<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers/pause:3.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ExecReload<span style="color:#f92672">=</span>/bin/kill -s HUP $MAINPID
</span></span><span style="display:flex;"><span>TimeoutSec<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>RestartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>always
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>StartLimitBurst<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>StartLimitInterval<span style="color:#f92672">=</span>60s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LimitNOFILE<span style="color:#f92672">=</span>infinity
</span></span><span style="display:flex;"><span>LimitNPROC<span style="color:#f92672">=</span>infinity
</span></span><span style="display:flex;"><span>LimitCORE<span style="color:#f92672">=</span>infinity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TasksMax<span style="color:#f92672">=</span>infinity
</span></span><span style="display:flex;"><span>Delegate<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>KillMode<span style="color:#f92672">=</span>process
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>åœ¨<code>/usr/lib/systemd/system/cri-docker.socket</code>å†™å…¥ä¸‹é¢å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>CRI Docker Socket <span style="color:#66d9ef">for</span> the API
</span></span><span style="display:flex;"><span>PartOf<span style="color:#f92672">=</span>cri-docker.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Socket<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ListenStream<span style="color:#f92672">=</span>%t/cri-dockerd.sock
</span></span><span style="display:flex;"><span>SocketMode<span style="color:#f92672">=</span><span style="color:#ae81ff">0660</span>
</span></span><span style="display:flex;"><span>SocketUser<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>SocketGroup<span style="color:#f92672">=</span>docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>sockets.target
</span></span></code></pre></div><p>å…³äºè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å‚è€ƒ<a class="link" href="https://www.cnblogs.com/ggzhangxiaochao/p/15039617.html"  target="_blank" rel="noopener"
    >Linuxé…ç½®serviceæœåŠ¡</a>ï¼Œ<a class="link" href="http://www.jinbuguo.com/systemd/systemd.socket.html"  target="_blank" rel="noopener"
    >systemd.socket ä¸­æ–‡æ‰‹å†Œ</a>ï¼Œè¿™ç¯‡æ–‡ç« ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å¯åŠ¨è¿™ä¸ªæœåŠ¡ï¼Œè¿™æ ·cri-dockerdå®é™…ä¸Šå°±æœ‰æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„åå«cri-dockerçš„serviceæ‰€ç®¡ç†ï¼š</p>
<pre tabindex="0"><code class="language-she" data-lang="she">systemctl daemon-reload
systemctl start cri-docker
systemctl enable cri-docker
systemctl status cri-docker
</code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨æ¯æ¬¡å¯åŠ¨é›†ç¾¤å‰ï¼Œå°±ä¸è¦æ‰‹åŠ¨çš„é…ç½®è¿è¡Œcri-dockerdï¼Œsystemdå°±å¸®æˆ‘ä»¬å®Œæˆè¿™äº›æ“ä½œäº†ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a class="link" href="https://www.modb.pro/db/428370"  target="_blank" rel="noopener"
    >åŸºäºdockerå’Œcri-dockerdéƒ¨ç½²Kubernetes 1.24</a></li>
<li><a class="link" href="https://www.qikqiak.com/post/containerd-usage/"  target="_blank" rel="noopener"
    >ä¸€æ–‡ææ‡‚å®¹å™¨è¿è¡Œæ—¶ Containerd</a></li>
<li><a class="link" href="https://opencontainers.org/"  target="_blank" rel="noopener"
    >Open Container Initiative</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/migrate-dockershim-dockerd/"  target="_blank" rel="noopener"
    >å°† Docker Engine èŠ‚ç‚¹ä» dockershim è¿ç§»åˆ° cri-dockerd</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/blog/2022/02/17/dockershim-faq/"  target="_blank" rel="noopener"
    >æ›´æ–°ï¼šç§»é™¤ Dockershim çš„å¸¸è§é—®é¢˜</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/check-if-dockershim-removal-affects-you/"  target="_blank" rel="noopener"
    >æ£€æŸ¥ç§»é™¤ Dockershim æ˜¯å¦å¯¹ä½ æœ‰å½±å“</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/"  target="_blank" rel="noopener"
    >æ’æŸ¥ CNI æ’ä»¶ç›¸å…³çš„é”™è¯¯</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#cri-versions"  target="_blank" rel="noopener"
    >å®¹å™¨è¿è¡Œæ—¶</a></li>
<li><a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/"  target="_blank" rel="noopener"
    >ç½‘ç»œæ’ä»¶</a></li>
<li><a class="link" href="https://github.com/kubernetes-sigs"  target="_blank" rel="noopener"
    >kubernetes-sigs</a>/<strong><a class="link" href="https://github.com/kubernetes-sigs/cri-tools"  target="_blank" rel="noopener"
    >cri-tools</a></strong></li>
<li><a class="link" href="https://github.com/Mirantis"  target="_blank" rel="noopener"
    >Mirantis</a>/<strong><a class="link" href="https://github.com/Mirantis/cri-dockerd"  target="_blank" rel="noopener"
    >cri-dockerd</a></strong></li>
<li><a class="link" href="https://blog.51cto.com/liuzhengwei521/2382257"  target="_blank" rel="noopener"
    >k8så¸è½½flannelç½‘ç»œ</a></li>
<li><a class="link" href="https://www.cnblogs.com/lianngkyle/p/15171630.html"  target="_blank" rel="noopener"
    >kubernetes/k8s CNIåˆ†æ-å®¹å™¨ç½‘ç»œæ¥å£åˆ†æ</a></li>
<li><a class="link" href="https://www.cnblogs.com/ggzhangxiaochao/p/15039617.html"  target="_blank" rel="noopener"
    >Linuxé…ç½®serviceæœåŠ¡</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">äº‘åŸç”Ÿ</a>
        
            <a href="/tags/kubernetes/">Kubernetes</a>
        
            <a href="/tags/docker/">docker</a>
        
            <a href="/tags/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a>
        
            <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">ä¸­é—´ä»¶</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/%E8%AE%B0%E4%B8%80%E6%AC%A1kubernetes%E4%BD%BF%E7%94%A8ciliumcoredns%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%8E%92%E9%94%99/">
        
        

        <div class="article-details">
            <h2 class="article-title">è®°ä¸€æ¬¡Kubernetesä½¿ç”¨Ciliumï¼Œcorednså¥åº·æ£€æŸ¥å¤±è´¥çš„æ’é”™</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/sinan-ml-based-and-qos-aware-resource-management-for-cloud-microservices/">
        
        

        <div class="article-details">
            <h2 class="article-title">Sinan: ML-Based and QoS-Aware Resource Management for Cloud Microservices</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/ieee-cloud-21-%E4%BA%91%E4%B8%8A%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E5%90%88%E8%BE%91/">
        
        

        <div class="article-details">
            <h2 class="article-title">IEEE CLOUD 21 äº‘ä¸Šèµ„æºç®¡ç†ç›¸å…³åˆè¾‘</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/showar-right-sizing-and-efficient-scheduling-of-microservices/">
        
        

        <div class="article-details">
            <h2 class="article-title">SHOWAR: Right-Sizing And Efficient Scheduling of Microservices</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E7%AC%94%E8%AE%B0-showar-right-sizing-and-efficient-scheduling-of-microservices/">
        
        

        <div class="article-details">
            <h2 class="article-title">ç¬”è®° &gt; SHOWAR: Right-Sizing And Efficient Scheduling of Microservices</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2018 - 
        
        2023 fmt.Println(&#34;Li Duo&#34;)
    </section>
    
    <section class="powerby">
        
            è‡ªè®¤ä¸ºæ˜¯å¹»è±¡æ³¢æ™®æ˜Ÿçš„æ¥å®¢ <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
